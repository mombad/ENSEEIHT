package allumettes;

public class Arbitre {
	private Joueur joueur1;
	private Joueur joueur2;
	private boolean confiant;
	
	public Arbitre(Joueur j1, Joueur j2, boolean conf) {
		this.joueur1 = j1;
		this.joueur2 = j2;
		this.confiant = conf;
	}
	
	public void faireJouer(Jeu jeu,Joueur j) throws OperationInterditeException  {
		int prise = 0;
		boolean fini = true;
			while (fini) {	
				try {
				System.out.println("Nombre d'allumettes restantes : " + jeu.getNombreAllumettes());
				System.out.println("Au tour de " + j.getNom() + ".");	
				prise = j.getPrise(jeu);
				if (jeu instanceof JeuReel) {
					jeu.retirer(prise);
				}
				else {
					((Procuration)jeu).retirerPartie(prise);
				}
				System.out.print(j.getNom() + " prend " + prise);
				if (prise > 1) {
					System.out.println(" allumettes.");
				}
				else {
					System.out.println(" allumette.");	
					}
				
				fini = false;
			}
			catch (CoupInvalideException e) {
				System.out.println(e.getMessage());				
				}			
			}
	}
	
	
	
	public void arbitrer(Jeu jeu) {
		boolean partie_finie = false;
		int j;
		while (!partie_finie) {	
			j = 1;
			partie_finie = testFinJeu(jeu, partie_finie,j);
			partie_finie = gestionTriche(jeu,this.joueur1, partie_finie);
			j = 2;
			partie_finie = testFinJeu(jeu,partie_finie,j);
			partie_finie = gestionTriche(jeu,this.joueur2,partie_finie);	

			}
		}
				
	

		
	
	public boolean getConfiant() {
		return this.confiant;
	}
	
	
	public boolean gestionTriche(Jeu jeu, Joueur joueur, boolean partieFinie) {
		if (!partieFinie){
			try {
				System.out.println("");		
				faireJouer(jeu,joueur);				
				return false;
		}
			catch (OperationInterditeException e) {
				System.out.print(e.getMessage());
				System.out.print(joueur + " a triché.");
				return true;
				}
			}
		else {
			return true;
		}
		}
		
	
	public boolean testFinJeu(Jeu jeu, boolean partieFinie,int j) {
			if (!partieFinie) {
				if (jeu.getNombreAllumettes()==0) {
					if (j==1) {
						System.out.println(this.joueur1.getNom() + " a gagné !");
						System.out.println(this.joueur2.getNom() + " a perdu !");
						}
					else {
						System.out.println(this.joueur1.getNom() + " a perdu !");
						System.out.println(this.joueur2.getNom() + " a gagné !");
						}
					return true;
					}
				else {
					return false;
					}
				}
			else {
				return true;
				}
			}
	}

